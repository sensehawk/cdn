/** Notice * This file contains works from many authors under various (but compatible) licenses. Please see core.txt for more information. **/
(function(){(window.wpCoreControlsBundle=window.wpCoreControlsBundle||[]).push([[21],{575:function(xa,ta,n){n.r(ta);var qa=n(0),na=n(7),oa=n(3);xa=n(54);var ha=n(33),la=n(14);n=function(){function ia(){this.init()}ia.prototype.init=function(){this.zka=!1;this.jg=this.Zn=this.connection=null;this.Hv={};this.ga=this.ML=null};ia.prototype.kGa=function(z){for(var aa=this,r=0;r<z.length;++r){var h=z[r];switch(h.at){case "create":this.Hv[h.author]||(this.Hv[h.author]=h.aName);this.vua(h);break;case "modify":this.ga.gr(h.xfdf).then(function(f){aa.ga.Ab(f[0])});
break;case "delete":this.ga.gr("<delete><id>"+h.aId+"</id></delete>")}}};ia.prototype.vua=function(z){var aa=this;this.ga.gr(z.xfdf).then(function(r){r=r[0];r.authorId=z.author;aa.ga.Ab(r);aa.ga.trigger(na.c.UPDATE_ANNOTATION_PERMISSION,[r])})};ia.prototype.Nta=function(z,aa,r){this.Zn&&this.Zn(z,aa,r)};ia.prototype.preloadAnnotations=function(z){this.addEventListener("webViewerServerAnnotationsEnabled",this.Nta.bind(this,z,"add",{imported:!1}),{once:!0})};ia.prototype.initiateCollaboration=function(z,
aa,r){var h=this;if(z){h.jg=aa;h.ga=r.ma();r.addEventListener(na.h.DOCUMENT_UNLOADED,function(){h.disableCollaboration()});h.SGa(z);var f=new XMLHttpRequest;f.addEventListener("load",function(){if(200===f.status&&0<f.responseText.length)try{var a=JSON.parse(f.responseText);h.connection=exports.da.dIa(Object(ha.k)(h.jg,"blackbox/"),"annot");h.ML=a.id;h.Hv[a.id]=a.user_name;h.ga.$U(a.id);h.connection.ALa(function(b){b.t&&b.t.startsWith("a_")&&b.data&&h.kGa(b.data)},function(){h.connection.send({t:"a_retrieve",
dId:z});h.trigger(ia.Events.WEBVIEWER_SERVER_ANNOTATIONS_ENABLED,[h.Hv[a.id],h.ML])},function(){h.disableCollaboration()})}catch(b){Object(oa.g)(b.message)}});f.open("GET",Object(ha.k)(this.jg,"demo/SessionInfo.jsp"));f.withCredentials=!0;f.send();h.zka=!0;h.ga.q$(function(a){return h.Hv[a.Author]||a.Author})}else Object(oa.g)("Document ID required for collaboration")};ia.prototype.disableCollaboration=function(){this.Zn&&(this.ga.removeEventListener(la.a.Events.ANNOTATION_CHANGED,this.Zn),this.Zn=
null);this.connection&&this.connection.dt();this.ga&&this.ga.$U("Guest");this.init();this.trigger(ia.Events.WEBVIEWER_SERVER_ANNOTATIONS_DISABLED)};ia.prototype.SGa=function(z){var aa=this;this.Zn&&this.ga.removeEventListener(la.a.Events.ANNOTATION_CHANGED,this.Zn);this.Zn=function(r,h,f){return Object(qa.b)(this,void 0,void 0,function(){var a,b,e,w,ea,y,ba,x,fa;return Object(qa.d)(this,function(ca){switch(ca.label){case 0:if(f.imported)return[2];a={t:"a_"+h,dId:z,annots:[]};return[4,aa.ga.e2()];
case 1:b=ca.ba();"delete"!==h&&(e=(new DOMParser).parseFromString(b,"text/xml"),w=new XMLSerializer);for(ea=0;ea<r.length;ea++)y=r[ea],x=ba=void 0,"add"===h?(ba=e.querySelector('[name="'+y.Id+'"]'),x=w.serializeToString(ba),fa=null,y.InReplyTo&&(fa=aa.ga.Dg(y.InReplyTo).authorId||"default"),a.annots.push({at:"create",aId:y.Id,author:aa.ML,aName:aa.Hv[aa.ML],parent:fa,xfdf:"<add>"+x+"</add>"})):"modify"===h?(ba=e.querySelector('[name="'+y.Id+'"]'),x=w.serializeToString(ba),a.annots.push({at:"modify",
aId:y.Id,xfdf:"<modify>"+x+"</modify>"})):"delete"===h&&a.annots.push({at:"delete",aId:y.Id});0<a.annots.length&&aa.connection.send(a);return[2]}})})}.bind(aa);this.ga.addEventListener(la.a.Events.ANNOTATION_CHANGED,this.Zn)};ia.Events={WEBVIEWER_SERVER_ANNOTATIONS_ENABLED:"webViewerServerAnnotationsEnabled",WEBVIEWER_SERVER_ANNOTATIONS_DISABLED:"webViewerServerAnnotationsDisabled"};return ia}();Object(xa.a)(n);ta["default"]=n}}]);}).call(this || window)
